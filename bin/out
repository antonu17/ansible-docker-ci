#!/bin/bash
set -e

SCRIPT_DIR=$( cd "$( dirname "${BASH_SOURCE[0]}" )" && pwd )
source ${SCRIPT_DIR}/helper

exec 3>&1
exec 1>&2

cd "$1"

payload=$(mktemp /tmp/resource-in.XXXXXX)

cat > $payload <&0

check=$(parse_json '.source.check')
script=$(parse_json '.source.script')
version_run=$(parse_json '.version.run')

echo "----"
cat $payload
echo "----"


#echo "version_run= $version"

if [ -f $script ]; then
    #$(script)
    echo '{"version": { "ref": "61cebf" },
  "metadata": [
    { "name": "commit", "value": "61cebf" },
    { "name": "author", "value": "Mick Foley" }
  ]
}'
else
    echo "${script} could not be found"
    exit 1
fi

exit 0